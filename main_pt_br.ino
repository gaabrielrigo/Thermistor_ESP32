/*
  This software, the ideas and concepts is Copyright (c) David Bird 2020
  All rights to this software are reserved.
  It is prohibited to redistribute or reproduce of any part or all of the software contents in any form other than the following:
  1. You may print or download to a local hard disk extracts for your personal and non-commercial use only.
  2. You may copy the content to individual third parties for their personal use, but only if you acknowledge the author David Bird as the source of the material.
  3. You may not, except with my express written permission, distribute or commercially exploit the content.
  4. You may not transmit it or store it in any other website or other form of electronic retrieval system for commercial purposes.
  5. You MUST include all of this copyright and permission notice ('as annotated') and this shall be included in all copies or substantial portions of the software
     and where the software use is visible to an end-user.
  THE SOFTWARE IS PROVIDED "AS IS" FOR PRIVATE USE ONLY, IT IS NOT FOR COMMERCIAL USE IN WHOLE OR PART OR CONCEPT.
  FOR PERSONAL USE IT IS SUPPLIED WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR
  A PARTICULAR PURPOSE AND NONINFRINGEMENT.
  IN NO EVENT SHALL THE AUTHOR OR COPYRIGHT HOLDER BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OR
  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
  See more at http://dsbird.org.uk
*/
//################# LIBRARIES ################
#include <WiFi.h>                      // Built-in
#include <ESPmDNS.h>                   // Built-in
#include <SPIFFS.h>                    // Built-in
#include "ESPAsyncWebServer.h"         // https://github.com/me-no-dev/ESPAsyncWebServer/tree/63b5303880023f17e1bca517ac593d8a33955e94
#include "AsyncTCP.h"                  // https://github.com/me-no-dev/AsyncTCP
//################  VERSION  ###########################################
String version = "1.0";      // Programme version, see change log at end
//################ VARIABLES ###########################################

const char* ServerName = "thermostat"; // Connect to the server with http://hpserver.local/ e.g. if name = "myserver" use http://myserver.local/

#define SensorReadings  144            // maximum number of sensor readings, typically 144/day at 6-per-hour
#define NumOfSensors    2              // number of sensors (+1), set by the graphing section
#define NumOfEvents     4              // Number of events per-day, 4 is a practical limit
#define noRefresh       false          // Set auto refresh OFF
#define Refresh         true           // Set auto refresh ON
#define ON              true           // Set the Relay ON
#define OFF             false          // Set the Relay OFF
#define RelayPIN        32              // Define the Relay Control pin
#define LEDPIN          5              // Define the LED Control pin
#define RelayReverse    false          // Set to true for Relay that requires a signal LOW for ON

#define SensorAddress   0x76           // Use 0x77 for an Adafruit variant
#define simulating      OFF            // Switch OFF for actual sensor readings, ON for simulated random values

typedef struct {
  float Temp = 0;
  byte  Humi = 0;
} sensordatatype;

sensordatatype sensordata[NumOfSensors][SensorReadings];

struct settings {
  String DoW;                // Day of Week for the programmed event
  String Start[NumOfEvents]; // Start time
  String Stop[NumOfEvents];  // End time
  String Temp[NumOfEvents];  // Required temperature during the Start-End times
};

//###############################################
const float ADC_LUT[4096] = { 0,
65.0000,66.8000,68.0000,69.8000,71.4000,73.0000,74.8000,76.2000,77.8000,79.6000,80.8000,82.0000,83.2000,84.6000,85.8000,
86.8000,88.0000,89.2000,90.6000,91.8000,93.0000,94.0000,95.2000,96.6000,97.4000,98.4000,99.4000,100.4000,101.2000,102.2000,
103.2000,104.2000,105.0000,106.0000,107.0000,108.0000,109.0000,110.0000,111.0000,112.0000,113.2000,114.8000,116.0000,117.2000,118.8000,
120.0000,121.2000,122.8000,124.0000,125.2000,126.8000,128.0000,129.0000,130.0000,131.4000,132.6000,133.8000,134.8000,136.0000,137.0000,
138.0000,139.2000,140.6000,141.8000,142.8000,143.8000,145.0000,146.0000,147.0000,148.2000,149.2000,150.4000,151.6000,152.8000,153.8000,
154.8000,155.8000,157.0000,158.0000,159.0000,160.0000,161.0000,162.0000,163.2000,164.2000,165.2000,166.2000,167.2000,168.2000,169.2000,
170.2000,171.2000,172.2000,173.2000,174.2000,175.2000,176.4000,177.4000,178.4000,179.4000,180.4000,181.4000,182.4000,183.6000,184.6000,
185.6000,186.6000,187.6000,188.6000,189.8000,190.8000,191.8000,192.8000,193.8000,194.8000,195.8000,196.8000,197.8000,198.8000,199.8000,
201.0000,202.0000,203.0000,204.0000,205.0000,206.0000,207.0000,208.0000,209.0000,210.2000,211.2000,212.4000,213.4000,214.4000,215.6000,
216.6000,217.8000,218.8000,219.8000,220.8000,221.8000,222.8000,223.8000,225.0000,226.0000,227.0000,228.0000,229.2000,230.4000,231.6000,
232.8000,233.8000,234.8000,236.0000,237.0000,238.0000,239.0000,240.2000,241.6000,242.8000,243.8000,244.8000,246.0000,247.0000,248.0000,
249.0000,250.4000,251.6000,252.8000,253.8000,254.8000,256.0000,257.0000,258.0000,259.4000,260.8000,261.8000,263.0000,264.0000,265.2000,
266.4000,267.8000,268.8000,270.0000,271.0000,272.2000,273.0000,274.0000,275.0000,276.0000,277.0000,278.0000,279.0000,280.0000,281.0000,
282.0000,283.0000,284.0000,285.0000,285.8000,286.8000,287.8000,289.0000,290.0000,291.4000,292.8000,293.8000,295.0000,296.0000,297.4000,
298.8000,299.8000,301.0000,302.0000,303.4000,304.6000,305.4000,306.2000,307.0000,308.0000,309.0000,309.8000,310.8000,311.8000,312.6000,
313.2000,314.0000,315.0000,316.0000,316.8000,317.8000,318.8000,319.6000,320.6000,321.8000,323.0000,324.2000,325.8000,326.8000,328.0000,
329.4000,330.8000,332.0000,333.0000,334.4000,335.8000,336.8000,337.8000,338.8000,339.8000,340.8000,341.8000,342.6000,343.6000,344.4000,
345.4000,346.4000,347.2000,348.2000,349.0000,350.0000,351.0000,352.0000,353.2000,354.4000,355.8000,356.8000,358.0000,359.0000,360.2000,
361.6000,362.8000,363.8000,365.0000,366.0000,367.2000,368.6000,369.8000,370.8000,371.8000,372.8000,373.8000,375.0000,376.0000,377.0000,
378.0000,379.2000,380.4000,381.6000,382.6000,383.8000,384.8000,385.8000,387.0000,388.0000,389.2000,390.6000,391.8000,392.8000,394.0000,
395.0000,396.0000,397.4000,398.6000,399.8000,400.8000,401.8000,403.0000,404.0000,405.0000,406.0000,407.0000,408.0000,409.2000,410.4000,
411.4000,412.6000,413.8000,414.8000,415.8000,416.8000,417.8000,418.8000,419.8000,420.8000,421.8000,422.8000,423.8000,424.8000,425.8000,
426.8000,427.8000,428.8000,429.8000,430.8000,431.8000,432.8000,433.8000,434.8000,435.8000,436.8000,438.0000,439.0000,440.0000,441.0000,
442.0000,443.2000,444.4000,445.6000,446.6000,447.8000,448.8000,449.8000,450.8000,451.6000,452.6000,453.6000,454.4000,455.4000,456.4000,
457.2000,458.2000,459.2000,460.0000,461.0000,462.0000,463.0000,464.0000,465.0000,466.2000,467.4000,468.4000,469.6000,470.8000,471.8000,
472.8000,474.0000,475.0000,476.0000,477.0000,478.2000,479.4000,480.4000,481.4000,482.4000,483.6000,484.6000,485.6000,486.6000,487.6000,
488.6000,489.6000,490.6000,491.6000,492.6000,493.6000,494.6000,495.6000,496.8000,497.8000,499.0000,500.0000,501.2000,502.6000,503.8000,
504.8000,506.0000,507.0000,508.4000,509.8000,510.8000,512.0000,513.0000,514.0000,515.0000,516.0000,516.8000,517.8000,518.8000,519.8000,
520.8000,521.8000,522.8000,523.8000,524.8000,525.8000,526.8000,527.8000,528.8000,529.8000,531.0000,532.0000,533.0000,534.4000,535.6000,
536.8000,537.8000,539.0000,540.0000,541.2000,542.4000,543.6000,544.8000,545.8000,546.8000,547.8000,548.8000,549.8000,550.8000,551.8000,
552.8000,554.0000,555.0000,556.0000,557.0000,558.0000,559.0000,560.0000,561.0000,562.2000,563.6000,564.8000,565.8000,566.8000,568.0000,
569.0000,570.0000,571.0000,572.4000,573.6000,574.8000,575.8000,576.8000,577.8000,578.8000,579.8000,580.8000,581.8000,582.8000,583.8000,
584.8000,586.0000,587.0000,588.0000,589.0000,590.0000,591.0000,592.0000,593.0000,594.0000,595.4000,596.6000,597.8000,598.8000,599.8000,
601.0000,602.0000,603.0000,604.4000,605.6000,606.8000,607.8000,608.8000,609.4000,610.0000,610.8000,611.8000,612.2000,613.0000,613.8000,
614.6000,615.0000,616.0000,616.8000,617.4000,618.0000,618.8000,619.8000,620.2000,621.0000,621.8000,622.6000,623.0000,624.0000,625.0000,
626.4000,627.8000,629.0000,630.4000,631.8000,633.0000,634.4000,635.8000,637.0000,638.4000,639.8000,640.8000,641.8000,642.8000,643.8000,
644.8000,645.6000,646.4000,647.4000,648.2000,649.0000,650.0000,651.0000,652.0000,653.0000,654.0000,654.8000,655.8000,657.0000,658.2000,
659.8000,660.8000,662.0000,663.6000,664.8000,666.0000,667.6000,668.8000,670.0000,671.4000,672.8000,673.6000,674.6000,675.6000,676.4000,
677.4000,678.2000,679.2000,680.0000,681.0000,682.0000,683.0000,684.0000,685.0000,686.0000,687.0000,687.8000,689.0000,690.0000,691.0000,
692.2000,693.4000,694.6000,695.8000,696.8000,697.8000,698.8000,700.0000,701.0000,702.0000,703.2000,704.4000,705.4000,706.6000,707.8000,
708.8000,709.8000,710.8000,711.8000,713.0000,714.0000,715.0000,716.0000,717.0000,718.2000,719.2000,720.4000,721.6000,722.8000,723.8000,
724.8000,725.8000,726.8000,728.0000,729.0000,730.0000,731.0000,732.0000,733.2000,734.2000,735.4000,736.6000,737.6000,738.6000,739.6000,
740.6000,741.4000,742.4000,743.4000,744.4000,745.4000,746.4000,747.4000,748.4000,749.4000,750.4000,751.4000,752.4000,753.8000,754.8000,
756.0000,757.2000,758.6000,759.8000,761.0000,762.0000,763.4000,764.8000,765.8000,767.0000,768.2000,769.4000,770.4000,771.6000,772.6000,
773.8000,774.8000,775.8000,776.8000,777.8000,778.8000,780.0000,781.0000,782.0000,783.0000,784.0000,785.0000,786.0000,787.0000,788.0000,
789.0000,790.0000,791.0000,792.0000,793.0000,794.0000,795.0000,796.0000,797.0000,798.0000,799.0000,800.0000,801.0000,802.0000,803.0000,
804.0000,805.2000,806.2000,807.4000,808.6000,809.6000,810.8000,811.8000,812.8000,813.8000,814.8000,816.0000,817.0000,818.0000,819.0000,
820.0000,821.0000,822.0000,823.2000,824.2000,825.4000,826.4000,827.6000,828.6000,829.8000,830.8000,831.8000,832.8000,833.8000,835.0000,
836.0000,837.0000,838.2000,839.4000,840.6000,841.8000,842.8000,843.8000,845.0000,846.0000,847.0000,848.2000,849.0000,850.0000,851.0000,
851.8000,852.8000,853.8000,854.8000,855.6000,856.4000,857.2000,858.0000,859.0000,860.0000,861.0000,861.8000,862.8000,863.8000,864.8000,
865.8000,866.8000,868.0000,869.0000,870.0000,871.0000,872.2000,873.4000,874.6000,875.8000,876.8000,877.8000,878.8000,880.0000,881.0000,
882.4000,883.8000,885.0000,886.0000,887.4000,888.8000,889.8000,891.0000,892.4000,893.8000,894.8000,896.0000,897.4000,898.8000,900.0000,
901.0000,902.4000,903.8000,905.0000,906.0000,907.6000,908.8000,910.0000,911.2000,912.6000,913.6000,914.4000,915.4000,916.4000,917.4000,
918.4000,919.2000,920.2000,921.2000,922.2000,923.2000,924.2000,925.0000,926.0000,927.0000,928.0000,929.0000,930.0000,931.0000,932.0000,
933.0000,934.0000,935.0000,936.0000,937.0000,938.0000,939.0000,940.0000,941.0000,942.0000,943.0000,944.0000,945.0000,946.0000,947.0000,
948.0000,949.0000,950.2000,951.2000,952.4000,953.6000,954.6000,955.8000,956.8000,957.8000,958.8000,959.8000,960.8000,962.0000,963.0000,
964.0000,965.2000,966.4000,967.6000,968.8000,969.8000,970.8000,971.8000,973.0000,974.0000,975.0000,976.0000,977.0000,978.0000,979.0000,
980.0000,980.8000,981.8000,982.8000,983.8000,984.6000,985.4000,986.2000,987.0000,988.0000,989.0000,990.0000,990.8000,991.8000,992.8000,
994.0000,995.0000,996.2000,997.6000,998.8000,999.8000,1001.0000,1002.0000,1003.0000,1004.4000,1005.8000,1006.8000,1007.8000,1008.6000,1009.0000,
1009.4000,1009.8000,1010.0000,1010.8000,1011.0000,1011.6000,1012.0000,1012.2000,1012.8000,1013.0000,1013.8000,1014.0000,1014.6000,1014.8000,1015.2000,
1015.8000,1016.0000,1016.8000,1017.0000,1017.6000,1017.8000,1018.2000,1018.8000,1019.0000,1019.8000,1020.0000,1020.4000,1020.8000,1021.2000,1021.8000,
1022.0000,1022.8000,1023.0000,1023.4000,1023.8000,1024.4000,1025.0000,1026.0000,1027.0000,1027.8000,1028.8000,1029.8000,1030.6000,1031.4000,1032.2000,
1033.0000,1034.0000,1035.0000,1035.8000,1036.8000,1037.8000,1038.6000,1039.2000,1040.0000,1041.4000,1042.8000,1043.8000,1044.8000,1046.0000,1047.0000,
1048.4000,1049.8000,1050.8000,1051.8000,1053.0000,1054.0000,1055.4000,1056.6000,1057.6000,1058.8000,1059.8000,1060.8000,1061.8000,1062.8000,1063.8000,
1064.8000,1065.8000,1066.8000,1067.8000,1068.8000,1069.8000,1070.8000,1071.8000,1072.8000,1074.0000,1075.0000,1076.0000,1077.0000,1078.0000,1079.0000,
1080.2000,1081.4000,1082.4000,1083.6000,1084.6000,1085.8000,1086.8000,1087.8000,1088.8000,1089.8000,1090.8000,1091.8000,1092.8000,1093.6000,1094.6000,
1095.4000,1096.4000,1097.4000,1098.2000,1099.2000,1100.0000,1101.0000,1102.0000,1103.0000,1104.0000,1105.0000,1106.2000,1107.4000,1108.6000,1109.8000,
1110.8000,1111.8000,1113.0000,1114.0000,1115.0000,1116.4000,1117.6000,1118.8000,1119.8000,1120.8000,1121.4000,1122.0000,1122.8000,1123.8000,1124.4000,
1125.0000,1125.8000,1126.8000,1127.2000,1128.0000,1128.8000,1129.8000,1130.2000,1131.0000,1131.8000,1132.8000,1133.2000,1134.0000,1134.8000,1135.8000,
1136.4000,1137.8000,1139.0000,1140.4000,1141.8000,1143.0000,1144.4000,1145.8000,1147.0000,1148.6000,1149.8000,1151.0000,1152.4000,1153.2000,1154.0000,
1155.0000,1156.0000,1156.8000,1157.8000,1158.8000,1159.6000,1160.4000,1161.2000,1162.0000,1163.0000,1164.0000,1164.8000,1165.8000,1166.8000,1167.6000,
1168.4000,1169.4000,1170.6000,1171.6000,1172.8000,1173.8000,1174.8000,1175.8000,1176.8000,1177.8000,1178.8000,1179.8000,1180.8000,1182.0000,1183.0000,
1184.0000,1185.0000,1186.2000,1187.6000,1188.8000,1189.8000,1191.0000,1192.0000,1193.4000,1194.8000,1195.8000,1197.0000,1198.0000,1199.4000,1200.6000,
1201.8000,1202.8000,1204.0000,1205.0000,1206.0000,1207.2000,1208.4000,1209.6000,1210.8000,1211.8000,1213.0000,1214.0000,1215.0000,1216.2000,1217.2000,
1218.0000,1219.0000,1220.0000,1221.0000,1222.0000,1223.0000,1224.0000,1225.0000,1226.0000,1227.0000,1228.0000,1229.0000,1230.0000,1231.0000,1232.0000,
1233.0000,1234.0000,1235.0000,1236.0000,1237.0000,1238.0000,1239.0000,1239.8000,1240.8000,1241.8000,1242.8000,1243.8000,1244.8000,1245.8000,1246.8000,
1247.8000,1248.8000,1249.8000,1250.8000,1251.8000,1252.8000,1253.8000,1254.8000,1255.8000,1256.8000,1257.8000,1258.8000,1259.6000,1260.6000,1261.6000,
1262.6000,1263.6000,1264.8000,1266.0000,1267.4000,1268.8000,1270.2000,1271.8000,1273.0000,1274.8000,1276.0000,1277.6000,1278.8000,1280.2000,1281.2000,
1282.2000,1283.2000,1284.2000,1285.2000,1286.2000,1287.2000,1288.2000,1289.2000,1290.2000,1291.2000,1292.2000,1293.2000,1294.2000,1295.2000,1296.2000,
1297.2000,1298.2000,1299.2000,1300.2000,1301.2000,1302.4000,1303.4000,1304.4000,1305.4000,1306.4000,1307.4000,1308.4000,1309.4000,1310.6000,1311.6000,
1312.6000,1313.4000,1314.4000,1315.4000,1316.2000,1317.2000,1318.0000,1319.0000,1320.0000,1321.0000,1322.0000,1323.0000,1324.0000,1325.0000,1326.0000,
1326.8000,1327.8000,1329.0000,1330.0000,1331.0000,1332.0000,1333.4000,1334.6000,1335.8000,1336.8000,1337.8000,1339.0000,1340.0000,1341.0000,1342.2000,
1343.4000,1344.6000,1345.6000,1346.6000,1347.8000,1348.8000,1349.8000,1350.8000,1351.8000,1352.8000,1353.8000,1354.8000,1355.8000,1356.8000,1357.8000,
1358.8000,1359.8000,1360.8000,1361.8000,1362.8000,1363.8000,1364.8000,1365.8000,1366.8000,1367.8000,1368.8000,1369.6000,1370.6000,1371.4000,1372.4000,
1373.4000,1374.2000,1375.2000,1376.2000,1377.0000,1378.0000,1379.0000,1380.0000,1381.0000,1382.0000,1383.0000,1384.0000,1385.0000,1386.0000,1387.0000,
1388.0000,1389.0000,1390.0000,1391.0000,1392.0000,1393.0000,1394.6000,1395.8000,1397.0000,1398.6000,1399.8000,1401.0000,1402.6000,1403.8000,1405.0000,
1406.6000,1407.8000,1409.0000,1410.0000,1411.0000,1412.0000,1413.2000,1414.4000,1415.6000,1416.8000,1417.8000,1418.8000,1419.8000,1421.0000,1422.0000,
1423.0000,1424.0000,1425.0000,1426.0000,1427.0000,1427.8000,1428.8000,1429.8000,1430.6000,1431.4000,1432.2000,1433.0000,1434.0000,1435.0000,1436.0000,
1436.8000,1437.8000,1438.8000,1439.6000,1440.6000,1441.8000,1442.8000,1443.8000,1445.0000,1446.0000,1447.0000,1448.2000,1449.4000,1450.6000,1451.8000,
1452.8000,1453.8000,1455.0000,1456.0000,1457.0000,1458.0000,1459.2000,1460.2000,1461.2000,1462.4000,1463.4000,1464.6000,1465.6000,1466.8000,1467.8000,
1468.8000,1469.8000,1470.8000,1471.8000,1473.0000,1474.0000,1475.0000,1476.2000,1477.4000,1478.8000,1479.8000,1480.8000,1482.0000,1483.0000,1484.0000,
1485.2000,1486.6000,1487.8000,1488.8000,1489.4000,1490.2000,1491.0000,1492.0000,1492.8000,1493.8000,1494.6000,1495.4000,1496.0000,1497.0000,1498.0000,
1498.8000,1499.8000,1500.6000,1501.2000,1502.0000,1503.0000,1503.8000,1505.0000,1506.0000,1507.4000,1508.8000,1509.8000,1511.0000,1512.0000,1513.4000,
1514.8000,1515.8000,1517.0000,1518.2000,1519.6000,1520.8000,1521.8000,1522.8000,1523.8000,1524.8000,1525.8000,1526.8000,1527.8000,1528.8000,1529.8000,
1531.0000,1532.0000,1533.0000,1534.0000,1535.0000,1536.0000,1537.0000,1538.2000,1539.4000,1540.8000,1541.8000,1542.8000,1544.0000,1545.0000,1546.2000,
1547.4000,1548.6000,1549.8000,1550.8000,1552.0000,1552.8000,1553.8000,1554.8000,1555.6000,1556.4000,1557.2000,1558.0000,1559.0000,1560.0000,1560.8000,
1561.8000,1562.8000,1563.4000,1564.2000,1565.0000,1566.0000,1567.0000,1567.8000,1569.0000,1570.0000,1571.4000,1572.8000,1573.8000,1575.0000,1576.4000,
1577.8000,1578.8000,1580.0000,1581.2000,1582.6000,1583.8000,1584.8000,1585.8000,1586.8000,1587.8000,1588.8000,1589.6000,1590.4000,1591.4000,1592.2000,
1593.0000,1594.0000,1595.0000,1596.0000,1597.0000,1598.0000,1598.8000,1599.8000,1601.0000,1602.0000,1603.4000,1604.8000,1606.0000,1607.0000,1608.4000,
1609.8000,1611.0000,1612.0000,1613.6000,1614.8000,1616.0000,1617.0000,1618.0000,1618.8000,1619.8000,1620.8000,1621.8000,1622.8000,1623.6000,1624.6000,
1625.4000,1626.4000,1627.2000,1628.0000,1629.0000,1630.0000,1631.0000,1632.0000,1633.0000,1634.0000,1634.8000,1635.8000,1636.8000,1637.8000,1638.8000,
1639.8000,1640.8000,1641.8000,1642.8000,1643.8000,1644.6000,1645.6000,1646.6000,1647.4000,1648.4000,1649.8000,1650.8000,1651.8000,1653.0000,1654.0000,
1655.2000,1656.4000,1657.6000,1658.8000,1659.8000,1661.0000,1662.0000,1663.0000,1664.2000,1665.0000,1666.0000,1667.0000,1668.0000,1668.8000,1669.8000,
1670.8000,1671.8000,1672.6000,1673.4000,1674.2000,1675.0000,1676.0000,1677.0000,1677.8000,1678.8000,1679.8000,1680.8000,1681.6000,1682.4000,1683.2000,
1684.0000,1685.0000,1686.0000,1686.8000,1687.8000,1688.8000,1689.6000,1690.4000,1691.2000,1692.0000,1693.0000,1694.0000,1694.8000,1695.8000,1696.8000,
1697.8000,1699.0000,1700.0000,1701.0000,1702.0000,1703.2000,1704.4000,1705.4000,1706.6000,1707.8000,1708.8000,1709.8000,1710.8000,1712.0000,1713.0000,
1714.0000,1715.4000,1716.6000,1717.8000,1718.8000,1720.0000,1721.0000,1722.0000,1723.4000,1724.6000,1725.8000,1726.8000,1728.0000,1729.0000,1730.0000,
1731.0000,1732.0000,1733.2000,1734.4000,1735.4000,1736.6000,1737.6000,1738.8000,1739.8000,1740.8000,1741.8000,1742.8000,1744.0000,1744.8000,1745.8000,
1746.8000,1747.8000,1748.8000,1749.8000,1750.8000,1751.6000,1752.6000,1753.4000,1754.4000,1755.2000,1756.2000,1757.0000,1758.0000,1759.0000,1760.0000,
1761.0000,1762.0000,1763.0000,1764.0000,1765.0000,1766.0000,1767.0000,1768.0000,1769.0000,1770.0000,1771.0000,1772.0000,1773.0000,1774.0000,1775.0000,
1776.0000,1777.0000,1778.4000,1779.8000,1780.8000,1782.0000,1783.2000,1784.8000,1785.8000,1787.0000,1788.0000,1789.6000,1790.8000,1792.0000,1793.0000,
1794.0000,1795.0000,1796.0000,1797.0000,1798.0000,1799.0000,1800.0000,1801.0000,1802.0000,1803.0000,1804.0000,1805.0000,1806.0000,1807.0000,1808.0000,
1809.0000,1810.0000,1811.0000,1812.0000,1813.2000,1814.4000,1815.6000,1816.8000,1817.8000,1818.8000,1819.8000,1820.8000,1822.0000,1823.0000,1824.0000,
1825.0000,1826.0000,1827.0000,1828.0000,1829.0000,1830.2000,1831.2000,1832.2000,1833.2000,1834.2000,1835.4000,1836.4000,1837.4000,1838.4000,1839.4000,
1840.6000,1841.6000,1842.8000,1843.8000,1844.8000,1845.8000,1846.8000,1847.8000,1848.8000,1850.0000,1851.0000,1852.0000,1853.0000,1854.0000,1855.0000,
1856.2000,1857.4000,1858.4000,1859.6000,1860.8000,1861.8000,1862.8000,1863.8000,1865.0000,1866.0000,1867.0000,1868.0000,1869.2000,1870.4000,1871.4000,
1872.6000,1873.6000,1874.6000,1875.6000,1876.6000,1877.8000,1878.8000,1879.8000,1880.8000,1881.8000,1882.8000,1883.8000,1884.8000,1885.8000,1886.8000,
1887.8000,1888.8000,1889.8000,1890.6000,1891.4000,1892.2000,1893.2000,1894.0000,1895.0000,1896.0000,1897.0000,1897.8000,1898.8000,1899.8000,1900.8000,
1901.8000,1902.6000,1903.4000,1904.4000,1905.8000,1906.8000,1908.0000,1909.4000,1910.8000,1912.0000,1913.0000,1914.4000,1915.8000,1917.0000,1918.0000,
1919.6000,1920.8000,1921.8000,1923.0000,1924.0000,1925.2000,1926.4000,1927.8000,1928.8000,1929.8000,1931.0000,1932.0000,1933.2000,1934.6000,1935.8000,
1936.8000,1937.8000,1938.8000,1940.0000,1941.0000,1942.0000,1943.0000,1944.0000,1945.2000,1946.2000,1947.4000,1948.4000,1949.6000,1950.8000,1951.8000,
1952.8000,1953.8000,1954.8000,1955.8000,1956.8000,1957.8000,1958.8000,1959.8000,1960.8000,1961.8000,1963.0000,1964.0000,1965.0000,1966.0000,1967.0000,
1968.0000,1969.0000,1970.0000,1971.2000,1972.4000,1973.6000,1974.8000,1975.8000,1976.8000,1977.8000,1979.0000,1980.0000,1981.0000,1982.0000,1983.2000,
1984.4000,1985.6000,1986.8000,1987.8000,1988.8000,1990.0000,1991.0000,1992.0000,1993.0000,1994.2000,1995.4000,1996.6000,1997.8000,1998.8000,1999.8000,
2000.8000,2001.8000,2002.8000,2003.8000,2004.8000,2005.8000,2006.8000,2007.8000,2008.8000,2009.6000,2010.6000,2011.6000,2012.4000,2013.4000,2014.4000,
2015.2000,2016.2000,2017.2000,2018.0000,2019.0000,2020.0000,2021.0000,2022.0000,2023.0000,2024.0000,2024.8000,2025.8000,2026.8000,2027.8000,2028.8000,
2029.8000,2030.8000,2031.8000,2032.8000,2033.8000,2034.8000,2036.0000,2037.0000,2038.2000,2039.4000,2040.6000,2041.8000,2042.8000,2044.0000,2045.0000,
2046.0000,2047.4000,2048.6001,2049.3999,2050.3999,2051.3999,2052.3999,2053.3999,2054.3999,2055.3999,2056.3999,2057.3999,2058.3999,2059.3999,2060.3999,
2061.3999,2062.3999,2063.3999,2064.3999,2065.6001,2066.8000,2067.8000,2069.0000,2070.0000,2071.0000,2072.2000,2073.3999,2074.8000,2075.8000,2076.8000,
2078.0000,2079.0000,2080.0000,2081.0000,2082.0000,2083.0000,2084.0000,2085.0000,2086.0000,2087.0000,2088.0000,2089.2000,2090.2000,2091.2000,2092.2000,
2093.2000,2094.2000,2095.2000,2096.2000,2097.2000,2098.0000,2099.0000,2100.0000,2101.0000,2102.0000,2103.0000,2104.0000,2105.0000,2106.0000,2107.0000,
2107.8000,2108.8000,2109.8000,2110.8000,2111.8000,2112.8000,2114.0000,2115.0000,2116.0000,2117.2000,2118.6001,2119.8000,2120.8000,2121.8000,2123.0000,
2124.0000,2125.0000,2126.3999,2127.6001,2128.8000,2129.8000,2130.8000,2131.8000,2132.8000,2133.8000,2134.8000,2135.8000,2136.8000,2137.8000,2138.8000,
2139.8000,2140.8000,2141.8000,2142.8000,2143.8000,2144.8000,2145.8000,2146.8000,2147.8000,2148.8000,2149.8000,2150.8000,2151.8000,2152.8000,2154.0000,
2155.0000,2156.0000,2157.0000,2158.0000,2159.0000,2160.0000,2161.2000,2162.8000,2164.0000,2165.0000,2166.6001,2167.8000,2169.0000,2170.3999,2171.8000,
2173.0000,2174.2000,2175.8000,2176.8000,2177.8000,2178.8000,2179.6001,2180.3999,2181.2000,2182.0000,2183.0000,2184.0000,2185.0000,2186.0000,2186.8000,
2187.8000,2188.8000,2189.8000,2190.6001,2191.3999,2192.2000,2193.0000,2194.0000,2194.8000,2195.8000,2196.6001,2197.2000,2198.0000,2199.0000,2199.8000,
2200.8000,2201.3999,2202.2000,2203.0000,2204.0000,2204.8000,2205.8000,2206.3999,2207.0000,2208.0000,2209.0000,2210.0000,2211.2000,2212.3999,2213.8000,
2214.8000,2215.8000,2216.8000,2218.0000,2219.0000,2220.0000,2221.2000,2222.6001,2223.8000,2224.8000,2225.8000,2226.8000,2227.8000,2228.8000,2229.8000,
2230.8000,2231.6001,2232.6001,2233.6001,2234.6001,2235.6001,2236.6001,2237.6001,2238.6001,2239.6001,2240.6001,2241.8000,2242.8000,2244.0000,2245.0000,
2246.2000,2247.6001,2248.8000,2249.8000,2251.0000,2252.0000,2253.2000,2254.6001,2255.8000,2256.8000,2257.8000,2258.8000,2259.8000,2260.8000,2261.8000,
2262.8000,2263.8000,2264.8000,2265.8000,2266.8000,2267.8000,2268.8000,2269.8000,2270.8000,2271.8000,2273.0000,2274.0000,2275.0000,2276.3999,2277.6001,
2278.8000,2279.8000,2280.8000,2282.0000,2283.0000,2284.2000,2285.3999,2286.6001,2287.8000,2288.8000,2289.8000,2290.8000,2291.8000,2292.8000,2293.8000,
2294.8000,2295.8000,2296.8000,2297.8000,2298.8000,2299.8000,2300.8000,2301.8000,2302.8000,2303.8000,2305.0000,2306.0000,2307.2000,2308.6001,2309.8000,
2310.8000,2312.0000,2313.0000,2314.3999,2315.8000,2316.8000,2317.8000,2319.0000,2320.0000,2321.2000,2322.6001,2323.8000,2324.8000,2325.8000,2326.8000,
2328.0000,2329.0000,2330.0000,2331.2000,2332.3999,2333.6001,2334.8000,2335.8000,2336.8000,2337.8000,2339.0000,2340.0000,2341.0000,2342.0000,2343.0000,
2344.2000,2345.2000,2346.3999,2347.6001,2348.6001,2349.8000,2350.8000,2351.8000,2352.8000,2353.8000,2354.8000,2355.8000,2357.0000,2358.0000,2359.0000,
2360.0000,2361.0000,2362.0000,2363.0000,2364.0000,2365.0000,2366.0000,2367.0000,2368.2000,2369.2000,2370.3999,2371.3999,2372.3999,2373.6001,2374.6001,
2375.8000,2376.8000,2377.8000,2378.8000,2379.8000,2380.8000,2381.8000,2382.8000,2384.0000,2385.0000,2385.8000,2386.8000,2387.8000,2388.8000,2389.8000,
2390.8000,2391.8000,2392.8000,2393.8000,2394.8000,2395.8000,2396.8000,2397.8000,2398.8000,2399.8000,2400.8000,2401.8000,2402.8000,2403.8000,2405.0000,
2406.0000,2407.0000,2408.0000,2409.0000,2410.2000,2411.2000,2412.3999,2413.3999,2414.6001,2415.6001,2416.8000,2418.0000,2419.0000,2420.6001,2421.8000,
2423.0000,2424.2000,2425.8000,2426.8000,2428.0000,2429.3999,2430.8000,2432.0000,2433.0000,2434.0000,2435.0000,2436.0000,2437.0000,2438.0000,2439.2000,
2440.2000,2441.2000,2442.3999,2443.3999,2444.3999,2445.6001,2446.6001,2447.8000,2448.8000,2449.8000,2450.8000,2451.8000,2452.8000,2453.8000,2455.0000,
2456.0000,2457.0000,2458.0000,2459.0000,2460.0000,2461.0000,2462.2000,2463.2000,2464.3999,2465.3999,2466.6001,2467.8000,2468.8000,2469.8000,2470.8000,
2471.8000,2472.8000,2473.8000,2475.0000,2476.0000,2477.0000,2478.0000,2479.0000,2480.0000,2481.2000,2482.3999,2483.6001,2484.8000,2485.8000,2486.8000,
2487.8000,2488.8000,2490.0000,2491.0000,2492.0000,2493.0000,2494.2000,2495.3999,2496.3999,2497.3999,2498.3999,2499.3999,2500.3999,2501.3999,2502.3999,
2503.3999,2504.3999,2505.3999,2506.3999,2507.3999,2508.3999,2509.3999,2510.3999,2511.3999,2512.2000,2513.2000,2514.2000,2515.2000,2516.2000,2517.2000,
2518.2000,2519.2000,2520.0000,2521.0000,2522.0000,2523.0000,2524.0000,2525.0000,2526.0000,2527.0000,2528.0000,2529.0000,2530.2000,2531.2000,2532.3999,
2533.3999,2534.6001,2535.8000,2536.8000,2537.8000,2538.8000,2539.8000,2540.8000,2542.0000,2543.0000,2544.0000,2545.0000,2546.0000,2547.2000,2548.3999,
2549.6001,2550.8000,2551.8000,2552.8000,2553.8000,2555.0000,2556.0000,2557.0000,2558.2000,2559.3999,2560.3999,2561.6001,2562.6001,2563.6001,2564.6001,
2565.8000,2566.8000,2567.8000,2568.8000,2569.8000,2570.8000,2571.8000,2572.8000,2573.8000,2574.8000,2575.8000,2577.0000,2578.0000,2579.0000,2580.3999,
2581.6001,2582.8000,2583.8000,2585.0000,2586.0000,2587.0000,2588.3999,2589.6001,2590.8000,2591.8000,2592.8000,2593.8000,2595.0000,2596.0000,2597.0000,
2598.0000,2599.0000,2600.0000,2601.0000,2602.0000,2603.0000,2604.0000,2605.0000,2606.2000,2607.2000,2608.2000,2609.2000,2610.2000,2611.2000,2612.2000,
2613.2000,2614.2000,2615.2000,2616.2000,2617.2000,2618.2000,2619.2000,2620.2000,2621.2000,2622.2000,2623.2000,2624.2000,2625.3999,2626.6001,2627.8000,
2628.8000,2629.8000,2630.8000,2632.0000,2633.0000,2634.0000,2635.0000,2636.2000,2637.3999,2638.6001,2639.8000,2640.8000,2641.8000,2642.8000,2644.0000,
2645.0000,2646.0000,2647.0000,2648.0000,2649.2000,2650.3999,2651.3999,2652.6001,2653.8000,2654.8000,2655.8000,2656.8000,2657.8000,2658.8000,2659.8000,
2660.8000,2661.8000,2662.8000,2663.8000,2664.8000,2665.8000,2666.8000,2667.6001,2668.6001,2669.6001,2670.6001,2671.6001,2672.8000,2674.0000,2675.8000,
2677.0000,2678.8000,2680.0000,2681.8000,2683.0000,2684.8000,2686.0000,2687.8000,2688.8000,2689.8000,2690.8000,2691.8000,2692.6001,2693.3999,2694.2000,
2695.2000,2696.0000,2697.0000,2698.0000,2699.0000,2699.8000,2700.8000,2701.8000,2702.8000,2703.6001,2704.6001,2705.8000,2706.8000,2708.0000,2709.0000,
2710.0000,2711.3999,2712.6001,2713.8000,2714.8000,2716.0000,2717.0000,2718.0000,2719.3999,2720.6001,2721.3999,2722.2000,2723.0000,2724.0000,2725.0000,
2726.0000,2726.8000,2727.8000,2728.8000,2729.8000,2730.6001,2731.3999,2732.2000,2733.0000,2734.0000,2735.0000,2736.0000,2736.8000,2737.8000,2738.6001,
2739.2000,2740.0000,2741.0000,2741.8000,2742.8000,2743.6001,2744.2000,2745.0000,2746.0000,2746.8000,2747.8000,2748.6001,2749.2000,2750.0000,2751.0000,
2751.8000,2752.8000,2753.8000,2754.8000,2755.8000,2756.8000,2757.8000,2758.8000,2759.8000,2760.8000,2761.8000,2762.8000,2763.8000,2764.6001,2765.6001,
2766.6001,2767.6001,2768.6001,2769.8000,2770.8000,2771.8000,2772.8000,2773.8000,2775.0000,2776.0000,2777.0000,2778.0000,2779.2000,2780.2000,2781.3999,
2782.6001,2783.8000,2784.8000,2785.8000,2786.8000,2787.8000,2788.8000,2790.0000,2791.0000,2792.0000,2793.0000,2794.0000,2795.0000,2796.0000,2797.2000,
2798.3999,2799.3999,2800.6001,2801.8000,2803.0000,2804.3999,2805.8000,2807.0000,2808.2000,2809.8000,2810.8000,2812.0000,2813.6001,2814.8000,2816.0000,
2817.0000,2818.0000,2819.0000,2820.0000,2820.8000,2821.8000,2822.8000,2823.8000,2824.8000,2825.8000,2826.8000,2827.8000,2828.6001,2829.6001,2830.6001,
2831.3999,2832.3999,2833.3999,2834.3999,2835.2000,2836.2000,2837.2000,2838.2000,2839.2000,2840.2000,2841.2000,2842.2000,2843.0000,2844.0000,2845.0000,
2846.0000,2847.0000,2848.0000,2849.0000,2850.2000,2851.2000,2852.3999,2853.3999,2854.6001,2855.8000,2856.8000,2857.8000,2858.8000,2859.8000,2860.8000,
2861.8000,2863.0000,2864.0000,2865.0000,2866.0000,2867.0000,2868.0000,2869.2000,2870.3999,2871.3999,2872.6001,2873.6001,2874.8000,2875.8000,2876.8000,
2877.8000,2878.8000,2880.0000,2881.0000,2882.0000,2883.0000,2884.0000,2885.0000,2886.0000,2887.0000,2888.0000,2889.0000,2890.0000,2891.0000,2892.0000,
2893.0000,2894.0000,2895.0000,2896.0000,2897.0000,2898.0000,2899.0000,2899.8000,2900.8000,2901.8000,2902.8000,2903.6001,2904.3999,2905.2000,2906.0000,
2907.0000,2908.0000,2909.0000,2909.8000,2910.8000,2911.8000,2912.8000,2913.8000,2915.0000,2916.0000,2917.2000,2918.3999,2919.8000,2920.8000,2921.8000,
2923.0000,2924.0000,2925.3999,2926.6001,2927.8000,2928.8000,2930.0000,2931.0000,2932.6001,2933.8000,2934.8000,2936.0000,2937.2000,2938.6001,2939.8000,
2940.8000,2942.0000,2943.2000,2944.6001,2945.8000,2946.8000,2948.0000,2949.2000,2950.6001,2951.8000,2952.8000,2954.0000,2955.2000,2956.6001,2957.8000,
2958.8000,2960.0000,2961.0000,2961.8000,2962.8000,2963.8000,2964.3999,2965.2000,2966.0000,2967.0000,2968.0000,2968.8000,2969.8000,2970.6001,2971.3999,
2972.2000,2973.0000,2974.0000,2974.8000,2975.8000,2976.8000,2977.8000,2978.8000,2980.0000,2981.0000,2982.0000,2983.2000,2984.3999,2985.6001,2986.8000,
2987.8000,2988.8000,2989.8000,2991.0000,2992.0000,2993.0000,2994.0000,2994.8000,2995.8000,2996.8000,2997.6001,2998.3999,2999.2000,3000.0000,3001.0000,
3002.0000,3003.0000,3003.8000,3004.8000,3005.8000,3006.8000,3007.6001,3008.3999,3009.8000,3010.8000,3012.0000,3013.0000,3014.3999,3015.8000,3016.8000,
3018.0000,3019.0000,3020.3999,3021.8000,3022.8000,3024.0000,3024.8000,3025.8000,3026.8000,3027.3999,3028.0000,3029.0000,3030.0000,3030.8000,3031.8000,
3032.3999,3033.2000,3034.0000,3035.0000,3035.8000,3036.8000,3037.6001,3038.2000,3039.0000,3040.0000,3041.0000,3042.0000,3043.0000,3044.2000,3045.3999,
3046.6001,3047.8000,3048.8000,3049.8000,3050.8000,3052.0000,3053.0000,3054.0000,3055.0000,3056.0000,3056.8000,3057.0000,3057.6001,3058.0000,3058.2000,
3058.8000,3059.0000,3059.8000,3060.0000,3060.3999,3060.8000,3061.0000,3061.8000,3062.0000,3062.6001,3062.8000,3063.2000,3063.8000,3064.0000,3064.6001,
3065.0000,3065.3999,3065.8000,3066.0000,3066.8000,3067.0000,3067.3999,3067.8000,3068.2000,3068.8000,3069.0000,3069.6001,3070.0000,3070.2000,3070.8000,
3071.0000,3071.8000,3072.0000,3072.8000,3073.8000,3074.8000,3075.8000,3076.8000,3077.8000,3078.8000,3079.8000,3080.8000,3081.8000,3082.8000,3083.8000,
3084.6001,3085.6001,3086.6001,3087.6001,3088.6001,3089.6001,3090.6001,3091.6001,3092.6001,3093.6001,3094.6001,3095.6001,3096.6001,3097.6001,3098.6001,
3099.6001,3100.6001,3101.6001,3102.6001,3103.6001,3104.6001,3105.6001,3106.6001,3107.3999,3108.3999,3109.3999,3110.3999,3111.3999,3112.3999,3113.3999,
3114.2000,3115.2000,3116.2000,3117.2000,3118.2000,3119.2000,3120.0000,3121.0000,3122.0000,3123.0000,3124.0000,3125.0000,3126.0000,3127.0000,3128.0000,
3128.8000,3129.8000,3130.8000,3131.8000,3132.8000,3133.8000,3134.8000,3135.8000,3136.8000,3137.8000,3138.6001,3139.6001,3140.6001,3141.6001,3142.6001,
3143.6001,3144.6001,3145.6001,3146.6001,3147.6001,3148.6001,3149.6001,3150.6001,3151.6001,3152.6001,3153.3999,3154.2000,3155.0000,3156.0000,3157.0000,
3158.0000,3158.8000,3159.8000,3160.8000,3161.8000,3162.8000,3163.6001,3164.3999,3165.2000,3166.0000,3167.0000,3168.0000,3169.0000,3170.0000,3171.0000,
3172.2000,3173.2000,3174.3999,3175.6001,3176.6001,3177.8000,3178.8000,3179.8000,3180.8000,3181.8000,3183.0000,3184.0000,3185.0000,3186.0000,3187.0000,
3188.2000,3189.3999,3190.3999,3191.6001,3192.8000,3193.8000,3194.8000,3195.8000,3196.8000,3198.0000,3199.0000,3200.0000,3201.0000,3202.0000,3203.2000,
3204.3999,3205.3999,3206.6001,3207.6001,3208.8000,3209.8000,3210.8000,3211.8000,3212.8000,3214.0000,3215.0000,3216.0000,3216.8000,3217.8000,3218.2000,
3219.0000,3219.8000,3220.8000,3221.2000,3222.0000,3222.8000,3223.8000,3224.2000,3225.0000,3225.8000,3226.8000,3227.2000,3228.0000,3228.8000,3229.6001,
3230.2000,3231.0000,3231.8000,3232.8000,3233.6001,3234.3999,3235.2000,3236.0000,3237.0000,3238.0000,3239.0000,3239.8000,3240.8000,3241.8000,3242.8000,
3243.6001,3244.3999,3245.2000,3246.0000,3247.0000,3248.0000,3248.8000,3249.8000,3250.6001,3251.2000,3252.0000,3253.0000,3253.8000,3254.8000,3255.3999,
3256.0000,3257.0000,3257.8000,3258.8000,3259.6001,3260.2000,3261.0000,3262.0000,3262.8000,3263.8000,3264.6001,3265.3999,3266.2000,3267.0000,3268.0000,
3269.0000,3270.0000,3270.8000,3271.8000,3272.8000,3273.8000,3274.6001,3275.3999,3276.2000,3277.0000,3278.0000,3279.0000,3280.0000,3280.8000,3281.8000,
3282.8000,3283.8000,3284.8000,3285.8000,3286.8000,3287.8000,3288.8000,3289.8000,3290.8000,3291.8000,3292.8000,3293.8000,3294.8000,3295.8000,3296.6001,
3297.3999,3298.2000,3299.0000,3300.0000,3301.0000,3301.8000,3302.8000,3303.8000,3304.3999,3305.2000,3306.0000,3307.0000,3308.0000,3308.8000,3309.8000,
3310.8000,3311.6001,3312.3999,3313.6001,3314.8000,3315.8000,3316.8000,3317.8000,3319.0000,3320.0000,3321.0000,3322.0000,3323.2000,3324.3999,3325.6001,
3326.8000,3327.8000,3328.8000,3329.8000,3330.8000,3331.6001,3332.3999,3333.2000,3334.0000,3335.0000,3336.0000,3337.0000,3338.0000,3338.8000,3339.8000,
3340.8000,3341.8000,3342.6001,3343.6001,3344.3999,3345.0000,3346.0000,3347.0000,3347.8000,3348.8000,3349.8000,3350.6001,3351.3999,3352.0000,3353.0000,
3354.0000,3354.8000,3355.8000,3356.8000,3357.6001,3358.2000,3359.0000,3360.0000,3361.0000,3362.0000,3362.8000,3363.8000,3364.8000,3365.8000,3366.8000,
3367.6001,3368.3999,3369.2000,3370.0000,3371.0000,3372.0000,3373.0000,3374.0000,3374.8000,3375.8000,3376.8000,3377.6001,3378.2000,3379.0000,3380.0000,
3380.8000,3381.8000,3382.6001,3383.2000,3384.0000,3385.0000,3385.8000,3386.8000,3387.6001,3388.2000,3389.0000,3390.0000,3390.8000,3391.8000,3392.6001,
3393.0000,3394.0000,3394.8000,3395.8000,3396.3999,3397.0000,3398.0000,3398.8000,3399.6001,3400.2000,3401.0000,3401.8000,3402.8000,3403.6001,3404.0000,
3405.0000,3405.8000,3406.8000,3407.3999,3408.0000,3409.0000,3409.8000,3410.8000,3411.8000,3412.6001,3413.3999,3414.0000,3415.0000,3416.0000,3416.8000,
3417.8000,3418.8000,3419.3999,3420.2000,3421.0000,3422.0000,3423.0000,3423.8000,3424.8000,3425.3999,3426.0000,3427.0000,3427.8000,3428.8000,3429.6001,
3430.2000,3431.0000,3432.0000,3432.8000,3433.8000,3434.3999,3435.0000,3436.0000,3436.8000,3437.8000,3438.6001,3439.2000,3440.0000,3441.0000,3442.0000,
3443.0000,3444.0000,3445.0000,3446.0000,3447.0000,3448.0000,3448.8000,3449.8000,3450.8000,3451.8000,3452.8000,3453.8000,3454.8000,3455.8000,3456.8000,
3457.8000,3458.3999,3459.2000,3460.0000,3461.0000,3462.0000,3462.8000,3463.8000,3464.8000,3465.6001,3466.3999,3467.2000,3468.0000,3469.0000,3470.0000,
3470.8000,3471.8000,3472.8000,3473.2000,3474.0000,3474.8000,3475.8000,3476.2000,3477.0000,3477.8000,3478.6001,3479.2000,3480.0000,3480.8000,3481.6001,
3482.2000,3483.0000,3483.8000,3484.6001,3485.2000,3486.0000,3486.8000,3487.6001,3488.2000,3489.0000,3489.8000,3490.8000,3491.2000,3492.0000,3492.8000,
3493.8000,3494.3999,3495.0000,3496.0000,3496.8000,3497.6001,3498.0000,3499.0000,3499.8000,3500.6001,3501.2000,3502.0000,3502.8000,3503.8000,3504.3999,
3505.0000,3506.0000,3506.8000,3507.6001,3508.2000,3509.0000,3510.0000,3510.8000,3511.6001,3512.2000,3513.0000,3513.8000,3514.8000,3515.3999,3516.0000,
3517.0000,3517.8000,3518.8000,3519.3999,3520.0000,3520.8000,3521.8000,3522.2000,3523.0000,3523.8000,3524.3999,3525.0000,3525.8000,3526.8000,3527.2000,
3528.0000,3528.8000,3529.3999,3530.0000,3530.8000,3531.6001,3532.0000,3533.0000,3533.8000,3534.3999,3535.0000,3535.8000,3536.6001,3537.3999,3538.0000,
3539.0000,3539.8000,3540.8000,3541.3999,3542.0000,3543.0000,3543.8000,3544.8000,3545.6001,3546.2000,3547.0000,3548.0000,3548.8000,3549.6001,3550.2000,
3551.0000,3552.0000,3552.8000,3553.6001,3554.2000,3555.0000,3555.8000,3556.6001,3557.2000,3558.0000,3558.8000,3559.8000,3560.2000,3561.0000,3561.8000,
3562.8000,3563.3999,3564.0000,3565.0000,3565.8000,3566.3999,3567.0000,3568.0000,3568.8000,3569.2000,3570.0000,3570.8000,3571.3999,3572.0000,3572.8000,
3573.3999,3574.0000,3574.8000,3575.6001,3576.0000,3576.8000,3577.6001,3578.0000,3578.8000,3579.6001,3580.0000,3581.0000,3581.8000,3582.2000,3583.0000,
3583.8000,3584.2000,3585.0000,3585.8000,3586.8000,3587.2000,3588.0000,3588.8000,3589.8000,3590.2000,3591.0000,3591.8000,3592.8000,3593.2000,3594.0000,
3594.8000,3595.8000,3596.2000,3597.0000,3597.8000,3598.8000,3599.2000,3600.0000,3600.8000,3601.8000,3602.2000,3603.0000,3603.8000,3604.8000,3605.3999,
3606.0000,3607.0000,3607.8000,3608.3999,3609.0000,3610.0000,3610.8000,3611.6001,3612.0000,3613.0000,3613.8000,3614.6001,3615.2000,3616.0000,3616.8000,
3617.2000,3618.0000,3618.6001,3619.0000,3619.8000,3620.3999,3621.0000,3621.8000,3622.2000,3622.8000,3623.6001,3624.0000,3624.8000,3625.3999,3626.0000,
3626.8000,3627.0000,3627.8000,3628.6001,3629.0000,3629.8000,3630.2000,3631.0000,3631.8000,3632.0000,3632.8000,3633.6001,3634.0000,3634.8000,3635.3999,
3636.0000,3636.8000,3637.3999,3638.0000,3638.8000,3639.2000,3640.0000,3640.8000,3641.2000,3642.0000,3642.6001,3643.0000,3643.8000,3644.6001,3645.0000,
3645.8000,3646.3999,3647.0000,3647.8000,3648.3999,3649.0000,3649.8000,3650.0000,3650.8000,3651.3999,3652.0000,3652.8000,3653.0000,3653.8000,3654.3999,
3655.0000,3655.8000,3656.0000,3656.8000,3657.3999,3658.0000,3658.8000,3659.0000,3659.8000,3660.3999,3661.0000,3661.8000,3662.0000,3662.8000,3663.3999,
3664.0000,3664.8000,3665.3999,3666.0000,3666.8000,3667.6001,3668.0000,3669.0000,3669.8000,3670.3999,3671.0000,3671.8000,3672.6001,3673.0000,3674.0000,
3674.8000,3675.2000,3676.0000,3676.8000,3677.6001,3678.0000,3679.0000,3679.8000,3680.2000,3681.0000,3681.8000,3682.0000,3682.8000,3683.6001,3684.0000,
3684.8000,3685.3999,3686.0000,3686.8000,3687.3999,3688.0000,3688.8000,3689.2000,3690.0000,3690.8000,3691.0000,3691.8000,3692.6001,3693.0000,3693.8000,
3694.3999,3695.0000,3695.8000,3696.2000,3697.0000,3697.8000,3698.8000,3699.6001,3700.0000,3701.0000,3701.8000,3702.8000,3703.2000,3704.0000,3705.0000,
3705.8000,3706.6001,3707.0000,3708.0000,3708.8000,3709.8000,3710.3999,3711.0000,3712.0000,3712.8000,3713.3999,3714.0000,3714.8000,3715.6001,3716.0000,
3717.0000,3717.8000,3718.2000,3719.0000,3719.8000,3720.6001,3721.0000,3721.8000,3722.8000,3723.2000,3724.0000,3724.8000,3725.3999,3726.0000,3726.8000,
3727.6001,3728.2000,3728.8000,3729.6001,3730.0000,3730.8000,3731.3999,3732.0000,3732.8000,3733.2000,3733.8000,3734.6001,3735.0000,3735.8000,3736.3999,
3737.0000,3737.8000,3738.2000,3738.8000,3739.6001,3740.0000,3740.8000,3741.3999,3742.0000,3742.8000,3743.2000,3743.8000,3744.6001,3745.0000,3745.8000,
3746.0000,3746.8000,3747.3999,3748.0000,3748.6001,3749.0000,3749.8000,3750.0000,3750.8000,3751.3999,3752.0000,3752.6001,3753.0000,3753.8000,3754.2000,
3754.8000,3755.3999,3756.0000,3756.8000,3757.0000,3757.8000,3758.2000,3758.8000,3759.3999,3760.0000,3760.8000,3761.2000,3762.0000,3762.8000,3763.0000,
3763.8000,3764.6001,3765.0000,3765.8000,3766.3999,3767.0000,3767.8000,3768.3999,3769.0000,3769.8000,3770.2000,3771.0000,3771.8000,3772.2000,3772.8000,
3773.6001,3774.0000,3774.8000,3775.6001,3776.0000,3776.8000,3777.2000,3777.8000,3778.6001,3779.0000,3779.8000,3780.0000,3780.8000,3781.3999,3782.0000,
3782.8000,3783.0000,3783.8000,3784.3999,3785.0000,3785.6001,3786.0000,3786.8000,3787.2000,3787.8000,3788.6001,3789.0000,3789.8000,3790.0000,3790.8000,
3791.3999,3792.0000,3792.8000,3793.2000,3793.8000,3794.6001,3795.0000,3795.8000,3796.3999,3797.0000,3797.8000,3798.2000,3799.0000,3799.8000,3800.0000,
3800.8000,3801.6001,3802.0000,3802.8000,3803.3999,3804.0000,3804.8000,3805.2000,3806.0000,3806.8000,3807.0000,3807.8000,3808.6001,3809.0000,3809.8000,
3810.2000,3811.0000,3811.8000,3812.0000,3812.8000,3813.6001,3814.0000,3814.8000,3815.3999,3816.0000,3816.8000,3817.2000,3818.0000,3818.6001,3819.0000,
3819.8000,3820.3999,3821.0000,3821.8000,3822.2000,3823.0000,3823.8000,3824.0000,3824.8000,3825.6001,3826.0000,3826.8000,3827.3999,3828.0000,3828.8000,
3829.2000,3830.0000,3830.8000,3831.0000,3831.8000,3832.6001,3833.0000,3833.8000,3834.3999,3835.0000,3835.8000,3836.2000,3837.0000,3837.8000,3838.0000,
3838.8000,3839.6001,3840.0000,3840.8000,3841.2000,3842.0000,3842.6001,3843.0000,3843.8000,3844.2000,3844.8000,3845.6001,3846.0000,3846.8000,3847.0000,
3847.8000,3848.3999,3849.0000,3849.8000,3850.0000,3850.8000,3851.3999,3852.0000,3852.6001,3853.0000,3853.8000,3854.2000,3854.8000,3855.6001,3856.0000,
3856.8000,3857.0000,3857.8000,3858.2000,3859.0000,3859.6001,3860.0000,3860.8000,3861.0000,3861.8000,3862.2000,3862.8000,3863.6001,3864.0000,3864.8000,
3865.0000,3865.8000,3866.2000,3866.8000,3867.3999,3868.0000,3868.8000,3869.0000,3869.8000,3870.2000,3870.8000,3871.3999,3872.0000,3872.6001,3873.0000,
3873.8000,3874.0000,3874.8000,3875.2000,3876.0000,3876.6001,3877.0000,3877.8000,3878.0000,3878.8000,3879.2000,3879.8000,3880.3999,3881.0000,3881.6001,
3882.0000,3882.8000,3883.0000,3883.8000,3884.2000,3885.0000,3885.6001,3886.0000,3886.8000,3887.0000,3887.8000,3888.2000,3888.8000,3889.6001,3890.0000,
3890.8000,3891.0000,3891.8000,3892.3999,3893.0000,3893.6001,3894.0000,3894.8000,3895.2000,3895.8000,3896.6001,3897.0000,3897.8000,3898.0000,3898.8000,
3899.3999,3900.0000,3900.8000,3901.0000,3901.8000,3902.2000,3903.0000,3903.6001,3904.0000,3904.8000,3905.0000,3905.8000,3906.0000,3906.8000,3907.0000,
3907.8000,3908.0000,3908.8000,3909.2000,3909.8000,3910.2000,3910.8000,3911.2000,3911.8000,3912.3999,3912.8000,3913.3999,3914.0000,3914.6001,3915.0000,
3915.6001,3916.0000,3916.6001,3917.0000,3917.8000,3918.0000,3918.8000,3919.0000,3919.8000,3920.0000,3920.8000,3921.2000,3921.8000,3922.3999,3923.0000,
3923.8000,3924.0000,3924.8000,3925.2000,3926.0000,3926.6001,3927.0000,3927.8000,3928.0000,3928.8000,3929.3999,3930.0000,3930.6001,3931.0000,3931.8000,
3932.0000,3932.8000,3933.3999,3934.0000,3934.6001,3935.0000,3935.8000,3936.2000,3936.8000,3937.2000,3937.8000,3938.3999,3938.8000,3939.3999,3940.0000,
3940.6001,3941.0000,3941.6001,3942.0000,3942.6001,3943.0000,3943.8000,3944.0000,3944.8000,3945.0000,3945.8000,3946.0000,3946.8000,3947.2000,3947.8000,
3948.2000,3948.8000,3949.2000,3949.8000,3950.3999,3951.0000,3951.3999,3952.0000,3953.3999,3955.8000,3958.0000,3960.2000,3962.6001,3964.8000,3967.00
};
//###############################################

String       Received_Data[10];                  // TxId, RxId, MsgCnt, Temperature, Humidity, RelayState, Incoming Msg, Msg Rssi, Msg SNR (10-fields are sent to this Rx)
String       SensorReading[NumOfSensors][6];     // 254 Sensors max. and 6 Parameters per sensor T, H, Relay-state. Maximum LoRa adress range is 255 - 1 for Server so 0 - 253
String       DataFile = "params.txt";            // Storage file name on flash
String       Time_str, DoW_str;                  // For Date and Time
settings     Timer[7];                           // Timer settings, 7-days of the week
int          SensorReadingPointer[NumOfSensors]; // Used for sensor data storage
float        Hysteresis     = 0.2;               // Heating Hysteresis default value
const String legendColour   = "black";           // Only use HTML colour names
const String titleColour    = "purple";
const String backgrndColour = "gainsboro";
const String data1Colour    = "red";
const String data2Colour    = "orange";

//################ VARIABLES ################
const char* ssid       = "Valdir";             // WiFi SSID     replace with details for your local network
const char* password   = "35657324";         // WiFi Password replace with details for your local network
const char* Timezone   = "BRST+3BRDT+2,M10.3.0,M2.3.0";
// Example time zones
//const char* Timezone = "MET-1METDST,M3.5.0/01,M10.5.0/02"; // Most of Europe
//const char* Timezone = "CET-1CEST,M3.5.0,M10.5.0/3";       // Central Europe
//const char* Timezone = "EST-2METDST,M3.5.0/01,M10.5.0/02"; // Most of Europe
//const char* Timezone = "EST5EDT,M3.2.0,M11.1.0";           // EST USA
//const char* Timezone = "CST6CDT,M3.2.0,M11.1.0";           // CST USA
//const char* Timezone = "MST7MDT,M4.1.0,M10.5.0";           // MST USA
//const char* Timezone = "NZST-12NZDT,M9.5.0,M4.1.0/3";      // Auckland
//const char* Timezone = "EET-2EEST,M3.5.5/0,M10.5.5/0";     // Asia
//const char* Timezone = "ACST-9:30ACDT,M10.1.0,M4.1.0/3":   // Australia

// System values
String sitetitle            = "Smart Thermostat";
String Year                 = "2022";     // For the footer line
float  Temperature          = 0;          // Variable for the current temperature
float  Humidity             = 0;          // Variable for the current temperature

float  TargetTemp           = 5;         // Default thermostat value for set temperature
int    FrostTemp            = 5;          // Default thermostat value for frost protection temperature
float  ManOverrideTemp      = 21;         // Manual override temperature
float  MaxTemperature       = 28;         // Maximum temperature detection, switches off thermostat when reached

bool   ManualOverride       = false;      // Manual override
int    EarlyStart           = 0;          // Default thermostat value for early start of heating
String RelayState           = "OFF";      // Current setting of the control/thermostat relay
String TimerState           = "OFF";      // Current setting of the timer
String Units                = "M";        // or Units = "I" for Â°F and 12:12pm time format

String webpage              = "";         // General purpose variable to hold HTML code for display
int    TimerCheckDuration   = 5000;       // Check for timer event every 5-seconds
int    LastReadingDuration  = 1;          // Add sensor reading every n-mins
int    LastTimerSwitchCheck = 0;          // Counter for last timer check
int    LastReadingCheck     = 0;          // Counter for last reading saved check
float  LastTemperature      = 0;          // Last temperature used for rogue reading detection
int    UnixTime             = 0;          // Time now (when updated) of the current time

AsyncWebServer server(80); // Server on IP address port 80 (web-browser default, change to your requirements, e.g. 8080
// To access server from outside of a WiFi (LAN) network e.g. on port 8080 add a rule on your Router that forwards a connection request
// to http://your_WAN_address:8080/ to http://your_LAN_address:8080 and then you can view your ESP server from anywhere.
// Example http://yourhome.ip:8080 and your ESP Server is at 192.168.0.40, then the request will be directed to http://192.168.0.40:8080

//#########################################################################################
void setup() {
  SetupSystem();                          // General system setup
  StartWiFi();                            // Start WiFi services
  SetupTime();                            // Start NTP clock services
  StartSPIFFS();                          // Start SPIFFS filing system
  Initialise_Array();                     // Initialise the array for storage and set some values
  RecoverSettings();                      // Recover settings from LittleFS
  SetupDeviceName(ServerName);            // Set logical device name
  // Set handler for '/'
  server.on("/", HTTP_GET, [](AsyncWebServerRequest * request) {
    request->redirect("/homepage");       // Go to home page
  });
  // Set handler for '/homepage'
  server.on("/homepage", HTTP_GET, [](AsyncWebServerRequest * request) {
    Homepage();
    request->send(200, "text/html", webpage);
  });
  // Set handler for '/graphs'
  server.on("/graphs", HTTP_GET, [](AsyncWebServerRequest * request)   {
    Graphs();
    request->send(200, "text/html", webpage);
  });
  // Set handler for '/timer'
  server.on("/timer", HTTP_GET, [](AsyncWebServerRequest * request) {
    TimerSet();
    request->send(200, "text/html", webpage);
  });
  // Set handler for '/setup'
  server.on("/setup", HTTP_GET, [](AsyncWebServerRequest * request) {
    Setup();
    request->send(200, "text/html", webpage);
  });
  // Set handler for '/help'
  server.on("/help", HTTP_GET, [](AsyncWebServerRequest * request) {
    Help();
    request->send(200, "text/html", webpage);
  });
  // Set handler for '/handletimer' inputs
  server.on("/handletimer", HTTP_GET, [](AsyncWebServerRequest * request) {
    for (byte dow = 0; dow < 7; dow++) {
      for (byte p = 0; p < NumOfEvents; p++) {
        Timer[dow].Temp[p]  = request->arg(String(dow) + "." + String(p) + ".Temp");
        Timer[dow].Start[p] = request->arg(String(dow) + "." + String(p) + ".Start");
        Timer[dow].Stop[p]  = request->arg(String(dow) + "." + String(p) + ".Stop");
      }
    }
    SaveSettings();
    request->redirect("/homepage");                       // Go back to home page
  });
  // Set handler for '/handlesetup' inputs
  server.on("/handlesetup", HTTP_GET, [](AsyncWebServerRequest * request) {
    if (request->hasArg("hysteresis")) {
      String numArg = request->arg("hysteresis");
      Hysteresis = numArg.toFloat();
    }
    if (request->hasArg("frosttemp")) {
      String numArg = request->arg("frosttemp");
      FrostTemp     = numArg.toFloat();
    }
    if (request->hasArg("earlystart")) {
      String numArg = request->arg("earlystart");
      EarlyStart    = numArg.toInt();
    }
    if (request->hasArg("manualoverride")) {
      String stringArg = request->arg("manualoverride");
      if (stringArg == "ON") ManualOverride = true; else ManualOverride = false;
    }
    if (request->hasArg("manualoverridetemp")) {
      String numArg   = request->arg("manualoverridetemp");
      ManOverrideTemp = numArg.toFloat();
    }
    SaveSettings();
    request->redirect("/homepage");                       // Go back to home page
  });
  server.begin();
  //StartSensor();
  ReadSensor();                                           // Get current sensor values
  for (int r = 0; r < SensorReadings; r++) {
    sensordata[1][r].Temp = Temperature;
    sensordata[1][r].Humi = Humidity;
  }
  ActuateHeating(OFF);                                    // Switch heating OFF
  ReadSensor();                                           // Get current sensor values
  LastTimerSwitchCheck = millis() + TimerCheckDuration;   // preload timer value with update duration
}
//#########################################################################################
void loop() {
  if ((millis() - LastTimerSwitchCheck) > TimerCheckDuration) {
    LastTimerSwitchCheck = millis();                      // Reset time
    ReadSensor();                                         // Get sensor readings, or get simulated values if 'simulated' is ON
    UpdateLocalTime();                                    // Updates Time UnixTime to 'now'
    CheckTimerEvent();                                    // Check for schedules actuated
  }
  if ((millis() - LastReadingCheck) > (LastReadingDuration * 60 * 1000)) {
    LastReadingCheck = millis();                          // Update reading record every ~n-mins e.g. 60,000uS = 1-min
    AssignSensorReadingsToArray();
  }
}
//#########################################################################################
void Homepage() {
  ReadSensor();
  append_HTML_header(Refresh);
  webpage += "<h2>Status do Termostato</h2><br>";
  webpage += "<div class='numberCircle'><span class=" + String((RelayState == "ON" ? "'on'>" : "'off'>")) + String(Temperature, 1) + "&deg;</span></div><br><br><br>";
  webpage += "<table class='centre'>";
  webpage += "<tr>";
  webpage += "<td>Temperatura</td>";
  //webpage += "<td>Humidity</td>";
  webpage += "<td>Temp Desejada</td>";
  webpage += "<td>Status do Termostato</td>";
  webpage += "<td>Status da Fila</td>";
  if (ManualOverride) {
    webpage += "<td>ManualOverride</td>";
  }
  webpage += "</tr>";
  webpage += "<tr>";
  webpage += "<td class='large'>" + String(Temperature, 1)       + "&deg;</td>";
  //webpage += "<td class='large'>" + String(Humidity, 0)          + "%</td>";
  webpage += "<td class='large'>" + String(TargetTemp, 1) + "&deg;</td>";
  webpage += "<td class='large'><span class=" + String((RelayState == "ON" ? "'on'>" : "'off'>")) + RelayState + "</span></td>"; // (condition ? that : this) if this then that else this
  webpage += "<td class='large'><span class=" + String((TimerState == "ON" ? "'on'>" : "'off'>")) + TimerState + "</span></td>";
  if (ManualOverride) {
    webpage += "<td class='large'>" + String(ManualOverride ? "ON" : "OFF") + "</td>";
  }
  webpage += "</tr>";
  webpage += "</table>";
  webpage += "<br>";
  //append_HTML_footer();
}
//#########################################################################################
void Graphs() {
  append_HTML_header(Refresh);
  webpage += "<h2>GrÃ¡fico de Temperatura</h2>";
  webpage += "<script type='text/javascript' src='https://www.gstatic.com/charts/loader.js'></script>";
  webpage += "<script type='text/javascript'>";
  webpage += "google.charts.load('current', {'packages':['corechart']});";
  webpage += "google.charts.setOnLoadCallback(drawGraphT1);"; // Pre-load function names for Temperature graphs
  //webpage += "google.charts.setOnLoadCallback(drawGraphH1);"; // Pre-load function names for Humidity graphs
  AddGraph(1, "GraphT", "Temperature", "TS", "Â°C", "red",  "chart_div");
  //AddGraph(1, "GraphH", "Humidity",    "HS", "%",  "blue", "chart_div");
  webpage += "</script>";
  webpage += "<div id='outer'>";
  webpage += "<table>";
  webpage += "<tr>";
  webpage += "  <td><div id='chart_divTS1' style='width:50%'></div></td>";
  //webpage += "  <td><div id='chart_divHS1' style='width:50%'></div></td>";
  webpage += "</tr>";
  webpage += "</table>";
  webpage += "<br>";
  webpage += "</div>";
  webpage += "<p>Status de Resfriamento : <span class=" + String((RelayState == "ON" ? "'on'>" : "'off'>")) + RelayState + "</span></p>";
  //append_HTML_footer();
}
//#########################################################################################
void TimerSet() {
  append_HTML_header(noRefresh);
  webpage += "<h2>Fila de Setup de Controle</h2><br>";
  webpage += "<h3>Insira as temperaturas e o tempo necessÃ¡rios, use o sÃ­mbolo do RelÃ³gio para facilitar a entrada do tempo</h3><br>";
  webpage += "<FORM action='/handletimer'>";
  webpage += "<table class='centre'>";
  webpage += "<col><col><col><col><col><col><col><col>";
  webpage += "<tr><td>Controle</td>";
  webpage += "<td>" + Timer[0].DoW + "</td>";
  for (byte dow = 1; dow < 6; dow++) { // Heading line showing DoW
    webpage += "<td>" + Timer[dow].DoW + "</td>";
  }
  webpage += "<td>" + Timer[6].DoW + "</td>";
  webpage += "</tr>";
  for (byte p = 0; p < NumOfEvents; p++) {
    webpage += "<tr><td>Temp</td>";
    webpage += "<td><input type='text' name='" + String(0) + "." + String(p) + ".Temp' value='"  + Timer[0].Temp[p]   + "' maxlength='5' size='6'></td>";
    for (int dow = 1; dow < 6; dow++) {
      webpage += "<td><input type='text' name='" + String(dow) + "." + String(p) + ".Temp' value='"      + Timer[dow].Temp[p] + "' maxlength='5' size='5'></td>";
    }
    webpage += "<td><input type='text' name='" + String(6) + "." + String(p) + ".Temp' value='"  + Timer[6].Temp[p]   + "' maxlength='5' size='5'></td>";
    webpage += "</tr>";
    webpage += "<tr><td>Start</td>";
    webpage += "<td><input type='time' name='" + String(0) + "." + String(p) + ".Start' value='" + Timer[0].Start[p] + "'></td>";
    for (int dow = 1; dow < 6; dow++) {
      webpage += "<td><input type='time' name='" + String(dow) + "." + String(p) + ".Start' value='" + Timer[dow].Start[p] + "'></td>";
    }
    webpage += "<td><input type='time' name='" + String(6) + "." + String(p) + ".Start' value='" + Timer[6].Start[p] + "'></td>";
    webpage += "</tr>";
    webpage += "<tr><td>Stop</td>";
    webpage += "<td><input type='time' name='" + String(0) + "." + String(p) + ".Stop' value='" + Timer[0].Stop[p] + "'></td>";
    for (int dow = 1; dow < 6; dow++) {
      webpage += "<td><input type='time' name='" + String(dow) + "." + String(p) + ".Stop' value='" + Timer[dow].Stop[p] + "'></td>";
    }
    webpage += "<td><input type='time' name='" + String(6) + "." + String(p) + ".Stop' value='" + Timer[6].Stop[p] + "'></td>";
    webpage += "</tr>";
    if (p < (NumOfEvents - 1)) {
      webpage += "<tr><td></td><td></td>";
      for (int dow = 2; dow < 7; dow++) {
        webpage += "<td>-</td>";
      }
      webpage += "<td></td></tr>";
    }
  }
  webpage += "</table>";
  webpage += "<div class='centre'>";
  webpage += "<br><input type='submit' value='Enter'><br><br>";
  webpage += "</div></form>";
  //append_HTML_footer();
}
//#########################################################################################
void Setup() {
  append_HTML_header(noRefresh);
  webpage += "<h2>Configuracao do Termostato</h2><br>";
  webpage += "<h3>Entre com os valores de parametro</h3><br>";
  webpage += "<FORM action='/handlesetup'>";
  webpage += "<table class='centre'>";
  webpage += "<tr>";
  webpage += "<td>DefiniÃ§oes</td><td>Valor</td>";
  webpage += "</tr>";
  webpage += "<tr>";
  webpage += "<td><label for='hysteresis'>Valor de Histerese (e.g. 0 - 1.0&deg;) [N.N]</label></td>";
  webpage += "<td><input type='text' size='4' pattern='[0-9][.][0-9]' name='hysteresis' value='" + String(Hysteresis, 1) + "'></td>"; // 0.0 valid input style
  webpage += "</tr>";
  webpage += "<tr>";
  webpage += "<td><label for='frosttemp'>Temperatura de protecao de congelamento&deg; [NN]</label></td>";
  webpage += "<td><input type='text' size='4' pattern='[0-9]*' name='frosttemp' value='" + String(FrostTemp) + "'></td>"; // 00-99 valid input style
  webpage += "</tr>";
  webpage += "<tr>";
  webpage += "<td><label for='earlystart'>DuraÃ§ao do inicio antecipado (min) [NN]</label></td>";
  webpage += "<td><input type='text' size='4' pattern='[0-9]*' name='earlystart' value='" + String(EarlyStart) + "'></td>"; // 00-99 valid input style
  webpage += "</tr>";
  webpage += "<tr>";
  webpage += "<td><label for='manualoveride'>Controle Manual </label></td>";
  webpage += "<td><select name='manualoverride'><option value='ON'>ON</option>";
  webpage += "<option selected value='OFF'>OFF</option></select></td>"; // ON/OFF
  webpage += "</tr>";
  webpage += "<td><label for='manualoverridetemp'>Controle Manual de Temperatura&deg; </label></td>";
  webpage += "<td><input type='text' size='4' pattern='[0-9]*' name='manualoverridetemp' value='" + String(ManOverrideTemp, 0) + "'></td>"; // 00-99 valid input style
  webpage += "</tr>";  webpage += "</table>";
  webpage += "<br><input type='submit' value='Enter'><br><br>";
  webpage += "</form>";
  //append_HTML_footer();
}
//#########################################################################################
void Help() {
  append_HTML_header(noRefresh);
  webpage += "<h2>Ajuda</h2><br>";
  webpage += "<div style='text-align: left;font-size:1.1em;'>";
  webpage += "<br><u><b>Menu de Setup</b></u>";
  webpage += "<p><i>Histerese</i> - esta configuraÃ§Ã£o Ã© usada para evitar a ativaÃ§Ã£o/desativaÃ§Ã£o rÃ¡pida indesejada do aquecimento Ã  medida que a temperatura ambiente";
  webpage += " se aproxima ou cai em direÃ§Ã£o Ã  temperatura definida/alvo. Uma configuraÃ§Ã£o normal Ã© 0,5&deg;C, o valor exato depende das caracterÃ­sticas ambientais, ";
  webpage += "por exemplo, onde o termostato estÃ¡ localizado e com que rapidez o ambiente resfria.</p>";
  webpage += "<p><i>Temperatura de proteÃ§Ã£o contra congelamento</i> - esta configuraÃ§Ã£o Ã© usada para proteger contra congelamento de tubos em condiÃ§Ãµes frias. ";
  webpage += "Ajuda a evitar danos por baixa temperatura, ligando o aquecimento atÃ© que o risco de congelamento seja evitado.</p>";
  webpage += "<p><i>Atraso do InÃ­cio</i> - se for superior a 0, inicia o resfriamento antes do programado para que a temperatura programada seja atingida no tempo definido.</p>";
  webpage += "<p><i>Controle Manual</i> - ligue o resfriamento e controle a temperatura desejada, desligando quando o prÃ³ximo perÃ­odo temporizado comeÃ§ar.</p>";
  webpage += "<p><i>Controle Manual de Temperatura</i> - usada para definir a temperatura de substituiÃ§Ã£o manual desejada.</p>";
  webpage += "<u><b>Menu de Filas</b></u>";
  webpage += "<p>Determina a temperatura de aquecimento para cada dia da semana e atÃ© 4 perÃ­odos de aquecimento em um dia. ";
  webpage += "Para definir o aquecimento para ligar Ã s 06:00 e desligar Ã s 09:00 com uma temperatura de 20&deg; introduza 20 e depois as horas de inÃ­cio/fim necessÃ¡rias. ";
  webpage += "Repita para cada dia da semana e perÃ­odo de aquecimento dentro do dia para o perfil de resfriamento necessÃ¡rio.</p>";
  webpage += "<u><b>Menu GrÃ¡fico</b></u>";
  webpage += "<p>Exibe a temperatura alvo definida e a temperatura medida atual. ";
  webpage += "O status do termostato tambÃ©m Ã© exibido conforme a temperatura varia.</p>";
  webpage += "<u><b>Menu de Status</b></u>";
  webpage += "<p>Exibe a temperatura atual. ";
  webpage += "Exibe a temperatura para a qual o termostato estÃ¡ controlando, o estado atual do termostato (ON/OFF) e ";
  webpage += "status do timer (ON/OFF).</p>";
  webpage += "</div>";
  //append_HTML_footer();
}
//#########################################################################################
String PreLoadChartData(byte Channel, String Type) {
  byte r = 0;
  String Data = "";
  do {
    if (Type == "Temperature") {
      Data += "[" + String(r) + "," + String(sensordata[Channel][r].Temp, 1) + "," + String(TargetTemp, 1) + "],";
    }
    else
    {
      Data += "[" + String(r) + "," + String(sensordata[Channel][r].Humi) + "],";
    }
    r++;
  } while (r < SensorReadings);
  Data += "]";
  return Data;
}
//#########################################################################################
void AddGraph(byte Channel, String Type, String Title, String GraphType, String Units, String Colour, String Div) {
  String Data = PreLoadChartData(Channel, Title);
  webpage += "function draw" + Type + String(Channel) + "() {";
  if (Type == "GraphT") {
    webpage += " var data = google.visualization.arrayToDataTable(" + String("[['Hour', 'Rm TÂ°', 'Set TÂ°'],") + Data + ");";
  }
  else
    webpage += " var data = google.visualization.arrayToDataTable(" + String("[['Hour', 'RH %'],") + Data + ");";
  webpage += " var options = {";
  webpage += "  title: '" + Title + "',";
  webpage += "  titleFontSize: 14,";
  webpage += "  backgroundColor: '" + backgrndColour + "',";
  webpage += "  legendTextStyle: { color: '" + legendColour + "' },";
  webpage += "  titleTextStyle:  { color: '" + titleColour  + "' },";
  webpage += "  hAxis: {color: '#FFF'},";
  webpage += "  vAxis: {color: '#FFF', title: '" + Units + "'},";
  webpage += "  curveType: 'function',";
  webpage += "  pointSize: 1,";
  webpage += "  lineWidth: 1,";
  webpage += "  width:  450,";
  webpage += "  height: 280,";
  webpage += "  colors:['" + Colour + (Type == "GraphT" ? "', 'orange" : "") + "'],";
  webpage += "  legend: { position: 'right' }";
  webpage += " };";
  webpage += " var chart = new google.visualization.LineChart(document.getElementById('" + Div + GraphType + String(Channel) + "'));";
  webpage += "  chart.draw(data, options);";
  webpage += " };";
}
//#########################################################################################
void CheckTimerEvent() {
  String TimeNow;
  UpdateTargetTemperature();
  TimeNow    = ConvertUnixTime(UnixTime);                  // Get the current time e.g. 15:35
  TimerState = "OFF";                                      // Switch timer off until decided by the schedule
  if (EarlyStart > 0) {                                    // If early start is enabled by a value > 0
    TimeNow = ConvertUnixTime(UnixTime + EarlyStart * 60); // Advance the clock by the Early Start Duration
  }
  if (ManualOverride == ON) {                              // If manual override is enabled then turn the heating on
    TargetTemp = ManOverrideTemp;                          // Set the target temperature to the manual overide temperature
    ControlHeating();                                      // Control the heating as normal
  }
  else
  {
    for (byte dow = 0; dow < 7; dow++) {                     // Look for any valid timer events, if found turn the heating on
      for (byte p = 0; p < NumOfEvents; p++) {
        // Now check for a scheduled ON time, if so Switch the Timer ON and check the temperature against target temperature
        if (String(dow) == DoW_str && (TimeNow >= Timer[dow].Start[p] && TimeNow <= Timer[dow].Stop[p] && Timer[dow].Start[p] != ""))
        {
          TimerState = "ON";
          ControlHeating();
          ManualOverride = OFF; // If it was ON turn it OFF when the timer starts a controlled period
        }
      }
    }
  }
  CheckAndSetFrostTemperature();
}
//#########################################################################################
void ControlHeating() {
  if (Temperature < (TargetTemp - Hysteresis)) {           // Check if room temeperature is below set-point and hysteresis offset
    ActuateHeating(OFF);                                    // Switch Relay/Heating ON if so
  }
  if (Temperature > (TargetTemp + Hysteresis)) {           // Check if room temeperature is above set-point and hysteresis offset
    ActuateHeating(ON);                                   // Switch Relay/Heating OFF if so
  }
  if (Temperature > MaxTemperature) {                      // Check for faults/over-temperature
    ActuateHeating(ON);                                   // Switch Relay/Heating OFF if temperature is above maximum temperature
  }
}
//#########################################################################################
void UpdateTargetTemperature() {
  String TimeNow;
  TimeNow = ConvertUnixTime(UnixTime);
  for (byte dow = 0; dow < 7; dow++) {
    for (byte p = 0; p < NumOfEvents; p++) {
      if (String(dow) == DoW_str && (TimeNow >= Timer[dow].Start[p] && TimeNow < Timer[dow].Stop[p]))
      {
        TargetTemp = Timer[dow].Temp[p].toFloat();               // Found the programmed set-point temperature from the scheduled time period
      }
    }
  }
  if (ManualOverride == ON) TargetTemp = ManOverrideTemp;
  Serial.println("Temperatura Desejada = " + String(TargetTemp, 1) + "Â°");
}
//#########################################################################################
void CheckAndSetFrostTemperature() {
  if (TimerState == "OFF" && ManualOverride == OFF) { // Only check for frost protection when heating is off
    if (Temperature < (FrostTemp - Hysteresis)) {     // Check if temperature is below Frost Protection temperature and hysteresis offset
      ActuateHeating(OFF);                             // Switch Relay/Heating ON if so
      Serial.println("Frost protection actuated...");
    }
    if (Temperature > (FrostTemp + Hysteresis)) {     // Check if temerature is above Frost Protection temperature and hysteresis offset
      ActuateHeating(ON);                            // Switch Relay/Heating OFF if so
    }
  }
}
//#########################################################################################
void ActuateHeating(bool demand) {
  pinMode(RelayPIN, OUTPUT);
  pinMode(LEDPIN, OUTPUT);
  if (demand) {
    RelayState = "ON";
    if (RelayReverse) {
      digitalWrite(RelayPIN, LOW);
    }
    else
    {
      digitalWrite(RelayPIN, HIGH);
    }
    digitalWrite(LEDPIN, LOW);
    Serial.println("Thermostat ON");
  }
  else
  {
    RelayState = "OFF";
    if (RelayReverse) {
      digitalWrite(RelayPIN, HIGH);
    }
    else
    {
      digitalWrite(RelayPIN, LOW);
    }
    digitalWrite(LEDPIN, HIGH);
    Serial.println("Thermostat OFF");
  }
}
//#########################################################################################
void ReadSensor() {
  if (simulating) {
    Temperature = 20.2 + random(-15, 15) / 10.0; // Generate a random temperature value between 18.7Â° and 21.7Â°
    Humidity    = random(45, 55);                // Generate a random humidity value between 45% and 55%
  }
  
    else{
    bool  isOn = NULL;
    double Beta = 3308.11;  // Beta value
    double Ro = 10000.0;   // Resistance of Thermistor at 25 degree Celsius
    double R1 = 10000.0;   // voltage divider resistor value
    double adcMax = 4095.0;
    double Vs = 3.3;
    double Vout, Rt = 0;
    double T, Tc, Tf = 0;
    double adc = 0;
    double To = 298.15;    // Temperature in Kelvin for 25 degree Celsius
    
    double val_adc[5];

    for(int i=0;i<5;i++){
    val_adc[i] = analogRead(35);
    adc += val_adc[i];
    } 
    adc = adc/5.0;
    adc = ADC_LUT[(int)adc];

    Vout = adc * Vs/adcMax;
    Rt = R1 * Vout / (Vs - Vout);
    
    T = 1/(1/To + log(Rt/Ro)/Beta);    // Temperature in Kelvin
    Temperature = (int)(T - 273.15);                   // Celsius
    //Humidity    = 45; 
    //Tf = Tc * 9 / 5 + 32;              // Fahrenheit

  }
}
//#########################################################################################
void AssignSensorReadingsToArray() {
  SensorReading[1][0] = 1;
  SensorReading[1][1] = Temperature;
  SensorReading[1][2] = Humidity;
  SensorReading[1][3] = RelayState;
  AddReadingToSensorData(1, Temperature, Humidity); // Only sensor-1 is implemented here, could  be more though
}
//#########################################################################################
void AddReadingToSensorData(byte RxdFromID, float Temperature, byte Humidity) {
  byte ptr, p;
  ptr = SensorReadingPointer[RxdFromID];
  sensordata[RxdFromID][ptr].Temp = Temperature;
  sensordata[RxdFromID][ptr].Humi = Humidity;
  ptr++;
  if (ptr >= SensorReadings) {
    p = 0;
    do {
      sensordata[RxdFromID][p].Temp  = sensordata[RxdFromID][p + 1].Temp;
      sensordata[RxdFromID][p].Humi  = sensordata[RxdFromID][p + 1].Humi;
      p++;
    } while (p < SensorReadings);
    ptr = SensorReadings - 1;
    sensordata[RxdFromID][SensorReadings - 1].Temp = Temperature;
    sensordata[RxdFromID][SensorReadings - 1].Humi = Humidity;
  }
  SensorReadingPointer[RxdFromID] = ptr;
}
//#########################################################################################
void append_HTML_header(bool refreshMode) {
  webpage  = "<!DOCTYPE html><html lang='en'>";
  webpage += "<head>";
  webpage += "<title>" + sitetitle + "</title>";
  webpage += "<meta charset='UTF-8'>";
  if (refreshMode) webpage += "<meta http-equiv='refresh' content='5'>"; // 5-secs refresh time, test needed to prevent auto updates repeating some commands
  webpage += "<script src=\"https://code.jquery.com/jquery-3.2.1.min.js\"></script>";
  webpage += "<style>";
  webpage += "body             {width:68em;margin-left:auto;margin-right:auto;font-family:Arial,Helvetica,sans-serif;font-size:14px;color:blue;background-color:#e1e1ff;text-align:center;}";
  webpage += ".centre          {margin-left:auto;margin-right:auto;}";
  webpage += "h2               {margin-top:0.3em;margin-bottom:0.3em;font-size:1.4em;}";
  webpage += "h3               {margin-top:0.3em;margin-bottom:0.3em;font-size:1.2em;}";
  webpage += "h4               {margin-top:0.3em;margin-bottom:0.3em;font-size:0.8em;}";
  webpage += ".on              {color: red;}";
  webpage += ".off             {color: limegreen;}";
  webpage += ".topnav          {overflow: hidden;background-color:lightcyan;}";
  webpage += ".topnav a        {float:left;color:blue;text-align:center;padding:1em 1.14em;text-decoration:none;font-size:1.3em;}";
  webpage += ".topnav a:hover  {background-color:deepskyblue;color:white;}";
  webpage += ".topnav a.active {background-color:lightblue;color:blue;}";
  webpage += "table tr, td     {padding:0.2em 0.5em 0.2em 0.5em;font-size:1.0em;font-family:Arial,Helvetica,sans-serif;}";
  webpage += "col:first-child  {background:lightcyan}col:nth-child(2){background:#CCC}col:nth-child(8){background:#CCC}";
  webpage += "tr:first-child   {background:lightcyan}";
  webpage += ".large           {font-size:1.8em;padding:0;margin:0}";
  webpage += ".medium          {font-size:1.4em;padding:0;margin:0}";
  webpage += ".ps              {font-size:0.7em;padding:0;margin:0}";
  webpage += "#outer           {width:100%;display:flex;justify-content:center;}";
  webpage += "footer           {padding:0.08em;background-color:cyan;font-size:1.1em;}";
  webpage += ".numberCircle    {border-radius:50%;width:2.7em;height:2.7em;border:0.11em solid blue;padding:0.2em;color:blue;text-align:center;font-size:3em;";
  webpage += "                  display:inline-flex;justify-content:center;align-items:center;}";
  webpage += ".wifi            {padding:3px;position:relative;top:1em;left:0.36em;}";
  webpage += ".wifi, .wifi:before {display:inline-block;border:9px double transparent;border-top-color:currentColor;border-radius:50%;}";
  webpage += ".wifi:before     {content:'';width:0;height:0;}";
  webpage += "</style></head>";
  webpage += "<body>";
  webpage += "<div class='topnav'>";
  webpage += "<a href='/'>Status</a>";
  webpage += "<a href='graphs'>GrÃ¡fico</a>";
  webpage += "<a href='timer'>Fila</a>";
  webpage += "<a href='setup'>Setup</a>";
  webpage += "<a href='help'>Ajuda</a>";
  webpage += "<a href=''></a>";
  webpage += "<a href=''></a>";
  webpage += "<a href=''></a>";
  webpage += "<a href=''></a>";
  webpage += "<div class='wifi'/></div><span>" + WiFiSignal() + "</span>";
  webpage += "</div><br>";
}
//#########################################################################################
/*
void append_HTML_footer() {
  webpage += "<footer>";
  webpage += "<p class='medium'>ESP Smart Thermostat</p>";
  webpage += "<p class='ps'><i>Copyright &copy;&nbsp;D L Bird " + String(Year) + " V" + version + "</i></p>";
  webpage += "</footer>";
  webpage += "</body></html>";
}
*/
//#########################################################################################
void SetupDeviceName(const char *DeviceName) {
  if (MDNS.begin(DeviceName)) { // The name that will identify your device on the network
    Serial.println("mDNS responder started");
    Serial.print("Device name: ");
    Serial.println(DeviceName);
    MDNS.addService("n8i-mlp", "tcp", 23); // Add service
  }
  else
    Serial.println("Error setting up MDNS responder");
}
//#########################################################################################
void StartWiFi() {
  Serial.print("\r\nConnecting to: "); Serial.println(String(ssid));
  IPAddress dns(8, 8, 8, 8); // Use Google as DNS
  WiFi.disconnect();
  WiFi.mode(WIFI_STA);       // switch off AP
  WiFi.setAutoConnect(true);
  WiFi.setAutoReconnect(true);
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    Serial.print(".");
    delay(50);
  }
  Serial.println("\nWiFi connected at: " + WiFi.localIP().toString());
}
//#########################################################################################
void SetupSystem() {
  pinMode(35,INPUT);
  Serial.begin(115200);                                           // Initialise serial communications
  delay(200);
  Serial.println(__FILE__);
  Serial.println("Starting...");
}
//#########################################################################################
boolean SetupTime() {
  configTime(0, 0, "time.nist.gov");                               // (gmtOffset_sec, daylightOffset_sec, ntpServer)
  setenv("TZ", Timezone, 1);                                       // setenv()adds "TZ" variable to the environment, only used if set to 1, 0 means no change
  tzset();
  delay(200);
  bool TimeStatus = UpdateLocalTime();
  return TimeStatus;
}
//#########################################################################################
boolean UpdateLocalTime() {
  struct tm timeinfo;
  time_t now;
  char  time_output[30];
  while (!getLocalTime(&timeinfo, 15000)) {                        // Wait for up to 15-sec for time to synchronise
    return false;
  }
  time(&now);
  UnixTime = now;
  //See http://www.cplusplus.com/reference/ctime/strftime/
  strftime(time_output, sizeof(time_output), "%H:%M", &timeinfo);  // Creates: '14:05'
  Time_str = time_output;
  strftime(time_output, sizeof(time_output), "%w", &timeinfo);     // Creates: '0' for Sun
  DoW_str  = time_output;
  return true;
}
//#########################################################################################
String ConvertUnixTime(int unix_time) {
  time_t tm = unix_time;
  struct tm *now_tm = localtime(&tm);
  char output[40];
  strftime(output, sizeof(output), "%H:%M", now_tm);               // Returns 21:12
  return output;
}
//#########################################################################################
void StartSPIFFS() {
  Serial.println("Starting SPIFFS");
  boolean SPIFFS_Status;
  SPIFFS_Status = SPIFFS.begin();
  if (SPIFFS_Status == false)
  { // Most likely SPIFFS has not yet been formated, so do so
    Serial.println("Formatting SPIFFS (it may take some time)...");
    SPIFFS.begin(true); // Now format SPIFFS
    File datafile = SPIFFS.open("/" + DataFile, "r");
    if (!datafile || !datafile.isDirectory()) {
      Serial.println("SPIFFS failed to start..."); // Nothing more can be done, so delete and then create another file
      SPIFFS.remove("/" + DataFile); // The file is corrupted!!
      datafile.close();
    }
  }
  else Serial.println("SPIFFS Started successfully...");
}
//#########################################################################################
void Initialise_Array() {
  Timer[0].DoW = "Dom"; Timer[1].DoW = "Seg"; Timer[2].DoW = "Ter"; Timer[3].DoW = "Qua"; Timer[4].DoW = "Qui"; Timer[5].DoW = "Sex"; Timer[6].DoW = "Sab";
}
//#########################################################################################
void SaveSettings() {
  Serial.println("Getting ready to Save settings...");
  File dataFile = SPIFFS.open("/" + DataFile, "w");
  if (dataFile) { // Save settings
    Serial.println("Saving settings...");
    for (byte dow = 0; dow < 7; dow++) {
      Serial.println("Day of week = " + String(dow));
      for (byte p = 0; p < NumOfEvents; p++) {
        dataFile.println(Timer[dow].Temp[p]);
        dataFile.println(Timer[dow].Start[p]);
        dataFile.println(Timer[dow].Stop[p]);
        Serial.println("Period: " + String(p) + " " + Timer[dow].Temp[p] + " from: " + Timer[dow].Start[p] + " to: " + Timer[dow].Stop[p]);
      }
    }
    dataFile.println(Hysteresis, 1);
    dataFile.println(FrostTemp, 1);
    dataFile.println(EarlyStart);
    Serial.println("Saved Hysteresis : " + String(Hysteresis));
    Serial.println("Saved Frost Temp : " + String(FrostTemp));
    Serial.println("Saved EarlyStart : " + String(EarlyStart));
    dataFile.close();
    Serial.println("Settings saved...");
  }
}
//#########################################################################################
void RecoverSettings() {
  String Entry;
  Serial.println("Reading settings...");
  File dataFile = SPIFFS.open("/" + DataFile, "r");
  if (dataFile) { // if the file is available, read it
    Serial.println("Recovering settings...");
    while (dataFile.available()) {
      for (byte dow = 0; dow < 7; dow++) {
        Serial.println("Day of week = " + String(dow));
        for (byte p = 0; p < NumOfEvents; p++) {
          Timer[dow].Temp[p]  = dataFile.readStringUntil('\n'); Timer[dow].Temp[p].trim();
          Timer[dow].Start[p] = dataFile.readStringUntil('\n'); Timer[dow].Start[p].trim();
          Timer[dow].Stop[p]  = dataFile.readStringUntil('\n'); Timer[dow].Stop[p].trim();
          Serial.println("Period: " + String(p) + " " + Timer[dow].Temp[p] + " from: " + Timer[dow].Start[p] + " to: " + Timer[dow].Stop[p]);
        }
      }
      Entry = dataFile.readStringUntil('\n'); Entry.trim(); Hysteresis = Entry.toFloat();
      Entry = dataFile.readStringUntil('\n'); Entry.trim(); FrostTemp  = Entry.toInt();
      Entry = dataFile.readStringUntil('\n'); Entry.trim(); EarlyStart = Entry.toInt();
      Serial.println("Recovered Hysteresis : " + String(Hysteresis));
      Serial.println("Recovered Frost Temp : " + String(FrostTemp));
      Serial.println("Recovered EarlyStart : " + String(EarlyStart));
      dataFile.close();
      Serial.println("Settings recovered...");
    }
  }
}
//#########################################################################################

//#########################################################################################
String WiFiSignal() {
  float Signal = WiFi.RSSI();
  Signal = 90 / 40.0 * Signal + 212.5; // From Signal = 100% @ -50dBm and Signal = 10% @ -90dBm and y = mx + c
  if (Signal > 100) Signal = 100;
  return " " + String(Signal, 0) + "%";
}

/*
   Version 1.0 795 lines of code
   All HTML fully validated by W3C
*/
